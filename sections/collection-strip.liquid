{% assign lazy_load = true %}
<div class="collection-strip-container collection-strip">
  <div class="page-width">
    <h2 class="section-heading">{{ section.settings.section_heading }}</h2>
    <p class="section-subheading">{{ section.settings.section_subheading }}</p>

    <div class="collection-strip-relative">
      <div class="collection-strip-wrapper" id="collectionStripScroller">
        {% for product in section.settings.collection.products %}
          <div class="collection-strip-item">
            {% render 'card-product', card_product: product, lazy_load: lazy_load, section_id: section.id %}
          </div>
        {% endfor %}
      </div>

      <!-- arrows -->
      <button class="scroller-arrow left" aria-label="Previous">
        <img
          src="https://cdn.shopify.com/s/files/1/0752/2510/4562/files/Group_433.png?v=1770214279"
        >
      </button>
      <button class="scroller-arrow right" aria-label="Next">
        <img
          src="https://cdn.shopify.com/s/files/1/0752/2510/4562/files/Group_433.png?v=1770214279"
          style="transform: rotate(180deg);"
        >
      </button>
    </div>

    <!-- dots -->
    <div class="collection-dots">
      <div class="collection-dots-track" id="collectionDots"></div>
    </div>

    <a href="{{ section.settings.cta_link }}" class="collection-strip-cta">
      {{ section.settings.cta }}
    </a>
  </div>
  {% if section.settings.image_left %}
  <img
    class="section_flower_left"
    src="{{section.settings.image_left | img_url: 'master' }}"
  >
  {% endif %}
  {% if section.settings.image_right %}
  <img
    class="section_flower_right"
    src="{{section.settings.image_right | img_url: 'master' }}"
  >
  {% endif %}
  <!-- bottom decoration -->
  <div class="collection-strip-bottom">
    <img
      class="collection-strip-bottom-strip"
      src="https://cdn.shopify.com/s/files/1/0752/2510/4562/files/Group_455.png?v=1769756289"
    >
    <img
      class="collection-strip-bottom-rotating"
      src="https://cdn.shopify.com/s/files/1/0752/2510/4562/files/Group_459_1.png?v=1769766247"
    >
    <img
      class="collection-strip-bottom-flower"
      src="https://cdn.shopify.com/s/files/1/0752/2510/4562/files/dfsf_13.png?v=1769756309"
    >
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Get all collection-strip sections
    document.querySelectorAll('.collection-strip').forEach((section) => {
      const scroller = section.querySelector('#collectionStripScroller');
      const dotsTrack = section.querySelector('#collectionDots');
      const prevBtn = section.querySelector('.scroller-arrow.left');
      const nextBtn = section.querySelector('.scroller-arrow.right');

      const items = [...scroller.children];
      if (!items.length) return;

      const itemsPerSlide = 3;
      const itemGap = 32;
      const itemWidth = items[0].offsetWidth;
      const slideWidth = (itemWidth + itemGap) * itemsPerSlide;

      const totalSlides = Math.ceil(items.length / itemsPerSlide);
      let currentSlide = 0;

      /* create dots */
      dotsTrack.innerHTML = '';
      for (let i = 0; i < totalSlides; i++) {
        const dot = document.createElement('button');
        if (i === 0) dot.classList.add('active');
        dot.onclick = () => goToSlide(i);
        dotsTrack.appendChild(dot);
      }

      const dots = [...dotsTrack.children];

      function goToSlide(index) {
        currentSlide = Math.max(0, Math.min(index, totalSlides - 1));
        scroller.scrollTo({ left: slideWidth * currentSlide, behavior: 'smooth' });
        updateDots();
      }

      function updateDots() {
        dots.forEach((dot, i) => {
          dot.classList.remove('active', 'prev', 'next');
          if (i === currentSlide) dot.classList.add('active');
          if (i === currentSlide - 1) dot.classList.add('prev');
          if (i === currentSlide + 1) dot.classList.add('next');
        });

        /* PERFECT CENTERING (dynamic width safe) */
        const activeDot = dots[currentSlide];
        const containerCenter = dotsTrack.parentElement.clientWidth / 2;
        const dotCenter = activeDot.offsetLeft + activeDot.offsetWidth / 2;

        dotsTrack.style.transform = `translateX(${Math.round(containerCenter - dotCenter)}px)`;
      }

      nextBtn.onclick = () => goToSlide(currentSlide + 1);
      prevBtn.onclick = () => goToSlide(currentSlide - 1);

      updateDots();
    });
  });
</script>
{% schema %}
{
  "name": "Collection Strip",
  "settings": [
    {
      "type": "text",
      "id": "section_heading",
      "label": "Section Heading"
    },
    {
      "type": "text",
      "id": "section_subheading",
      "label": "Section Subheading"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "text",
      "id": "cta",
      "label": "CTA"
    },
    {
      "type": "url",
      "label": "CTA Link",
      "id": "cta_link"
    },
    {
      "type": "image_picker",
      "id": "image_left",
      "label": "Floating Image Left"
    },
    {
      "type": "image_picker",
      "id": "image_right",
      "label": "Floating Image Right"
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Collection Strip"
    }
  ]
}
{% endschema %}